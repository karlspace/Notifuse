/subscribe:
  post:
    summary: Subscribe to email lists
    description: |
      Subscribe a contact to one or more email lists. This is a public endpoint that doesn't require authentication.

      **Important:** For unauthenticated requests, only **public lists** can be subscribed to. To subscribe to private lists, you can either:
      - Provide a valid `email_hmac` in the contact object (used by the notification center for re-subscribing after unsubscribing)
      - Use the authenticated `/api/lists.subscribe` endpoint with a bearer token

      If the list has double opt-in enabled, a confirmation email will be sent.
    operationId: subscribeToLists
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/contact.yaml#/SubscribeToListsRequest'
    responses:
      '200':
        description: Subscription successful
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  description: Whether the subscription was successful
                  example: true
      '400':
        description: Bad request - validation failed
        content:
          application/json:
            schema:
              $ref: '../components/schemas/common.yaml#/ErrorResponse'
            examples:
              missingWorkspaceId:
                value:
                  error: workspace_id is required
              invalidEmail:
                value:
                  error: 'invalid contact: invalid email format'
              missingListIds:
                value:
                  error: list_ids is required
              listNotPublic:
                value:
                  error: list is not public
      '500':
        description: Internal server error
        content:
          application/json:
            schema:
              $ref: '../components/schemas/common.yaml#/ErrorResponse'
            example:
              error: Failed to subscribe to lists

/api/lists.subscribe:
  post:
    summary: Subscribe to email lists (authenticated)
    description: |
      Subscribe a contact to one or more email lists. This is an authenticated endpoint that requires a bearer token.

      Unlike the public `/subscribe` endpoint, this endpoint can subscribe contacts to **any list** (public or private) as long as the authenticated user has write permission on lists.

      **Note:** Double opt-in is bypassed for authenticated requests. Contacts are immediately set to `active` status regardless of the list's double opt-in setting. This allows administrators to manually add contacts without requiring email confirmation.
    operationId: subscribeToListsAuthenticated
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/contact.yaml#/SubscribeToListsRequest'
    responses:
      '200':
        description: Subscription successful
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  description: Whether the subscription was successful
                  example: true
      '400':
        description: Bad request - validation failed
        content:
          application/json:
            schema:
              $ref: '../components/schemas/common.yaml#/ErrorResponse'
            examples:
              missingWorkspaceId:
                value:
                  error: workspace_id is required
              invalidEmail:
                value:
                  error: 'invalid contact: invalid email format'
              missingListIds:
                value:
                  error: list_ids is required
      '401':
        description: Unauthorized - invalid or missing authentication token
        content:
          application/json:
            schema:
              $ref: '../components/schemas/common.yaml#/ErrorResponse'
      '500':
        description: Internal server error
        content:
          application/json:
            schema:
              $ref: '../components/schemas/common.yaml#/ErrorResponse'
            example:
              error: Failed to subscribe to lists
